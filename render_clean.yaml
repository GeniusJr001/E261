services:
  - type: web
    name: e261-voice-backend
    runtime: python3
    # Ensure Rust/Cargo uses writable /tmp during Render build and prefer binary wheels
    buildCommand: |
      # create writable dirs first
      mkdir -p /tmp/build_home /tmp/.cargo /tmp/.cargo-target /tmp/.rustup
      export HOME=/tmp/build_home
      # run pip with env vars set inline so subprocesses used by pep517/maturin inherit them
      CARGO_HOME=/tmp/.cargo CARGO_TARGET_DIR=/tmp/.cargo-target RUSTUP_HOME=/tmp/.rustup HOME=/tmp/build_home pip install --upgrade pip setuptools wheel
      CARGO_HOME=/tmp/.cargo CARGO_TARGET_DIR=/tmp/.cargo-target RUSTUP_HOME=/tmp/.rustup HOME=/tmp/build_home pip install --prefer-binary -r requirements.txt
      chmod +x start.sh
    startCommand: "bash start.sh"
    plan: free
    env: python
    region: oregon
    env_vars:
      - key: PYTHON_VERSION
        value: "3.11.9"
      # Do NOT put real secrets here. Set them in Render Dashboard (Environment â†’ Secrets).
      - key: ELEVEN_API_KEY
        value: ""
      - key: ELEVEN_VOICE_ID
        value: ""
      - key: ZOHO_CLIENT_ID
        value: ""
      - key: ZOHO_CLIENT_SECRET
        value: ""
      - key: ZOHO_REFRESH_TOKEN
        value: ""
